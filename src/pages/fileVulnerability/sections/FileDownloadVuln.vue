<template>
  <q-page class="q-pa-md">
    <div class="row justify-center q-my-lg">
      <q-img :src="filevuln4" style="width: 500px"></q-img>
    </div>

    <div class="text-h5 text-weight-bold q-pt-md">✅소개</div>
    <div class="text-h6">
      웹 서비스에서 사용자가 업로드한 파일을 다시 다운로드하거나, 서버에 저장된 이미지·문서 파일을
      열람할 수 있도록 파일 다운로드 기능이 제공됩니다.
      <div>
        하지만 이 기능이 잘못 설계되면 공격자가 다운로드 요청 경로를 조 작해 서버 내부의 민감한
        시스템 파일을 다운로드할 수 있습니다.
      </div>
    </div>

    <div class="text-h5 text-weight-bold q-pt-xl">✅작동 원리</div>
    <div class="text-h6 text-weight-bold q-py-sm">⭕정상 흐름</div>
    <div class="text-h6">
      <div>1. 사용자가 다운로드 링크 클릭</div>
      <div class="q-pl-md">→ 예: <span style="color: red">/download?filename=report.pdf</span></div>
      <div>2. 서버는 특정 디렉터리( <span>./files/</span> )에서 해당 파일을 읽어 전송</div>
    </div>
    <div class="notion-like q-pt-sm">
      <div class="section">
        <q-card flat bordered class="code-block">
          <pre><code>filename = request.args.get('filename')
with open("files/" + filename, 'rb') as f:
    return f.read()</code></pre>
        </q-card>
      </div>
    </div>

    <div class="text-h6 text-weight-bold q-pt-md">❌취약 흐름: Path Traversal 다운로드</div>
    <div class="text-h6">
      <div class="q-pt-sm">
        1. 공격자가 filename 파라미터에 <span style="color: red">../</span> 삽입 → 예:
        <span style="color: red">../../../../etc/passwd</span>
      </div>
      <div class="q-py-sm">2. 서버가 이를 검증 없이 경로로 사용</div>
      <div>
        3. 내부 시스템 파일( <span style="color: red">/etc/passwd, .env</span> )을 다운로드할 수
        있음
      </div>
      <div class="q-pt-sm">
        <span class="text-weight-bold">➡️결과</span>: 민감 정보 탈취, DB인증 정보 노출, 시스템 정보
        획득 → 2차 공격 가능
      </div>
    </div>

    <div class="text-h5 text-weight-bold q-pt-xl">✅취약점이 발생하는 위치</div>
    <div class="text-h6 q-pl-lg">
      <div class="q-pt-sm" style="display: list-item; list-style-type: disc">
        파일 다운로드 링크가 파라미터로 파일명을 직접 받는 경우
      </div>
      <div class="q-py-sm" style="display: list-item; list-style-type: disc">
        이미지 또는 문서 미리보기 URL에서 서버 내부 경로를 조작할 수 있는 경우
      </div>
      <div style="display: list-item; list-style-type: disc">
        업로드 디렉터리가 아닌 외부 경로에 접근 가능할 때
      </div>
    </div>
    <div class="row justify-center q-my-lg">
      <q-img :src="filevuln5" style="width: 700px"></q-img>
    </div>

    <div class="text-h5 text-weight-bold q-pt-xl">✅발생 이유 및 주요 원인</div>
    <div class="row justify-center q-my-lg">
      <q-img :src="filevuln6" style="width: 700px"></q-img>
    </div>

    <div class="text-h5 text-weight-bold q-pt-xl">✅공격 기법</div>
    <div class="notion-like">
      <!-- 시스템 파일 다운로드 -->
      <div class="section text-h6">
        <ul class="q-mt-md">
          <li>시스템 파일 다운로드</li>
          <q-card flat bordered class="code-block">
            <pre><code>/download?filename=../../../etc/passwd</code></pre>
          </q-card>

          <div class="section q-my-lg">
            <div style="display: list-item; list-style-type: disc">환경 설정 파일 다운로드</div>
            <q-card flat bordered class="code-block">
              <pre><code>/download?filename=../../../.env</code></pre>
            </q-card>
          </div>
          <div style="display: list-item; list-style-type: disc">이미지 서버 우회 접근</div>
          <q-card flat bordered class="code-block">
            <pre><code>/images.php?fn=../../../secret/config.json</code></pre>
          </q-card>
        </ul>
      </div>
    </div>

    <div class="text-h5 text-weight-bold q-pt-xl">✅방어 기법</div>
    <div class="row justify-center q-my-lg">
      <q-img :src="filevuln6" style="width: 750px"></q-img>
    </div>
  </q-page>
</template>

<script setup>
import filevuln4 from 'src/assets/filevuln4.png'
import filevuln5 from 'src/assets/filevuln5.png'
import filevuln6 from 'src/assets/filevuln6.png'
</script>

<style scoped>
.notion-like {
  max-width: 800px;
  margin: auto;
}
.section {
  margin-bottom: 24px;
}
.title {
  margin-bottom: 12px;
  font-size: 1.25rem;
  font-weight: 500;
  color: #1f1f1f;
}
.code-block {
  background-color: #f6f8fa;
  border: 1px solid #e1e4e8;
  border-radius: 4px;
}
.code-block pre {
  margin: 0;
  padding: 12px 16px;
  font-family: 'Source Code Pro', monospace;
  font-size: 0.875rem;
  line-height: 1.4;
  white-space: pre-wrap;
}
</style>
