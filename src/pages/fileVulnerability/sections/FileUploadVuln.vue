<template>
  <q-page class="q-pa-md">
    <div class="row justify-center q-my-lg">
      <q-img :src="filevuln1" style="width: 400px"></q-img>
    </div>

    <div class="text-h5 text-weight-bold q-pt-md">✅소개</div>
    <div class="text-body1">
      <div>
        웹 서비스에서 사용자가 프로필 이미지, 게시판 첨부파일 등을 업로드할 수 있도록 제공되는
        기능이 많습니다.
      </div>
      <div>
        하지만 이 업로드 기능이 잘못 설계되면 공격자가 임의의 파일을 서버에 업로드하여, 서버 코드
        덮어쓰기, 웹
      </div>
      <div>셸 실행, 파일 시스템 침투 등의 공격을 할 수 있습니다.</div>
    </div>

    <div class="text-h5 text-weight-bold q-pt-xl">✅작동 원리</div>
    <div class="text-h6 text-weight-bold q-py-sm">⭕정상 흐름</div>
    <div class="text-body1">
      <div>1. 사용자가 웹 사이트의 업로드 폼을 통해 파일 제출</div>
      <div class="q-py-sm">2. 서버는 해당 파일을 정해진 디렉터리(ex: ./uploads/)에 저장</div>
      <div>3. 저장된 파일은 이미지 등으로 안전하게 활용됨</div>
    </div>
    <div class="notion-like">
      <!-- 파일 업로드 처리 코드 -->
      <div class="section q-pt-md">
        <q-card flat bordered class="code-block">
          <pre><code>f = request.files['file']
f.save("./uploads/" + f.filename)</code></pre>
        </q-card>
      </div>
    </div>

    <div class="text-h6 text-weight-bold q-py-sm">❌취약 흐름: Path Traversal</div>
    <div class="text-body1">
      <div>
        1. 공격자가 파일명에 <span style="color: red">../</span>등 실행 가능한 악성 파일 업로드
      </div>
      <div class="q-py-sm">2. 서버가 이를 검증 없이 경로로 사용 → uploads 밖에 저장됨</div>
      <div class="q-pb-sm">
        3. <span style="color: red">./uploads/../hack.py</span>→ 실제 경로는
        <span style="color: red">./hack.py</span>
      </div>
      <div>4. 서버 코드 덮어쓰기, 외부 디렉터리 침투 가능</div>
    </div>

    <div class="text-h6 text-weight-bold q-py-sm q-pt-md">❌취약 흐름: 웹셀 업로드</div>
    <div class="text-body1">
      <div>
        1. 공격자가 <span style="color: red">.php, .jsp</span>삽입 → 예:
        <span style="color: red">../hack.py</span>
      </div>

      <div class="q-py-sm">2. 서버가 이를 실행 가능한 위치에 저장</div>

      <div>3. 공격자가 웹 요쳥으로 해당 파일을 실행시켜 시스템 명령어 수행</div>
    </div>

    <div class="text-h5 text-weight-bold q-pt-xl">✅취약점이 발생하는 위치</div>
    <div class="text-body1">
      <div class="q-pt-sm" style="display: list-item; list-style-type: disc">
        게시판, 프로필 이미지, 문서 업로드 등 사용자 파일을 받는 기능 전반
      </div>
      <div class="q-py-sm" style="display: list-item; list-style-type: disc">
        서버가 파일명을 사용자 입력값으로 그대로 사용하는 경우
      </div>
      <div style="display: list-item; list-style-type: disc">
        업로드 후 저장 경로, 파일명, 확장자에 대한 필터링이 없거나 우회 가능한 경우
      </div>
    </div>

    <div class="text-h5 text-weight-bold q-pt-xl">✅발생 이유와 주요 원인</div>
    <div class="row justify-center q-my-lg">
      <q-img :src="filevuln2" style="width: 700px"></q-img>
    </div>

    <div class="text-h5 text-weight-bold q-pt-md">✅공격 기법</div>
    <div class="notion-like">
      <!-- Path Traversal 업로드 -->
      <div class="section">
        <div class="q-py-sm" style="display: list-item; list-style-type: disc">
          Path Traversal 업로드
        </div>
        <q-card flat bordered class="code-block">
          <pre><code>filename=../../app.py</code></pre>
        </q-card>
      </div>

      <!-- 악성 파일 업로드 -->
      <div class="section">
        <div class="q-pb-sm" style="display: list-item; list-style-type: disc">
          악성 파일 업로드
        </div>
        <q-card flat bordered class="code-block">
          <pre><code>&lt;?php system($_GET['cmd']); ?&gt;</code></pre>
        </q-card>
      </div>

      <!-- 웹 접근 -->
      <div class="section">
        <div class="q-pb-sm" style="display: list-item; list-style-type: disc">웹 접근</div>
        <q-card flat bordered class="code-block">
          <pre><code>https://example.com/uploads/shell.php?cmd=whoami</code></pre>
        </q-card>
      </div>
    </div>

    <div class="text-h5 text-weight-bold q-pt-xl">✅방어 기법</div>
    <div class="row justify-center q-my-lg">
      <q-img :src="filevuln3" style="width: 700px"></q-img>
    </div>
  </q-page>
</template>

<script setup>
import filevuln1 from 'src/assets/filevuln1.png'
import filevuln2 from 'src/assets/filevuln2.png'
import filevuln3 from 'src/assets/filevuln3.png'
</script>

<style scoped>
.notion-like {
  max-width: 800px;
  margin: auto;
}
.section {
  margin-bottom: 24px;
}
.title {
  margin-bottom: 12px;
  font-size: 1.25rem;
  font-weight: 500;
  color: #1f1f1f;
}
.code-block {
  background-color: #f6f8fa;
  border: 1px solid #e1e4e8;
  border-radius: 4px;
}
.code-block pre {
  margin: 0;
  padding: 12px 16px;
  font-family: 'Source Code Pro', monospace;
  font-size: 0.875rem;
  line-height: 1.4;
  white-space: pre-wrap;
}
</style>
